{% extends "../base/base.html" %}
{% load humanize %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<style>
    .chart-container {
        position: relative;
        width: 100%;
        max-width: 600px;
        height: 300px;
    }

    .chart-container2 {
        width: 500px;
        height: 300px;
        margin: 0 auto;
        /* centers it */
    }
</style>
<h2>Portfolio Summary</h2>
<p>Cash: {{ portfolio.cash_balance|floatformat:2 }}</p>
<p>Total Value: {{ portfolio.total_value|floatformat:2 }}</p>

<h3>Asset Allocation</h3>
<div class="chart-container">
    <canvas id="allocationChart"></canvas>
</div>


<h3>Portfolio Value Over Time</h3>
<div class="chart-container2">
    <canvas id="valueChart"></canvas>
</div>

<h3>Recent Trades</h3>
<table class="table">
    <thead>
        <tr>
            <th>Time</th>
            <th>Type</th>
            <th>Asset</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        {% for trade in trades %}
        <tr>
            <td>{{ trade.timestamp }}</td>
            <td>{{ trade.trade_type }}</td>
            <td>
                {% if trade.asset %}
                {{ trade.asset.symbol }}
                {% else %}
                -
                {% endif %}
            </td>
            <td>{{ trade.quantity|floatformat:2 }}</td>
            <td>{{ trade.price|floatformat:2 }}</td>
            <td>{{ trade.total_value|floatformat:2 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Asset allocation pie chart
    const allocationData = {
        labels: {{ allocation_labels| safe }},
    datasets: [{
        data: {{ allocation_values| safe }},
        backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e']
    }]
};

    new Chart(document.getElementById('allocationChart'), {
        type: 'pie',
        data: allocationData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Portfolio value line chart
    const valueData = {
        labels: {{ snapshot_labels| safe }},
    datasets: [{
        label: 'Portfolio Value',
        data: {{ snapshot_values| safe }},
        borderColor: '#4e73df',
        fill: false,
        tension: 0.3,
        pointRadius: 2
        }]
    };

    new Chart(document.getElementById('valueChart'), {
        type: 'line',
        data: valueData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    display: true
                },
                y: {
                    display: true
                }
            }
        }
    });
</script>


{% endblock %}